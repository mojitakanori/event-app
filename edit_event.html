<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>イベント編集 - イベント管理アプリ</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* create.html と同じスタイルを使用 */
        .preview-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .preview-container img, .preview-container video { max-width: 150px; max-height: 150px; object-fit: cover; border: 1px solid #ddd; border-radius: 4px; }
        .file-count-info { font-size: 0.9em; color: #555; margin-top: 5px; }
        .preview-item { position: relative; display: inline-flex; flex-direction: column; align-items: center; margin: 5px; }
        .preview-item img, .preview-item video { max-width: 120px; max-height: 120px; object-fit: cover; border: 1px solid #ddd; border-radius: 4px; display: block; }
        .preview-item .remove-preview-btn { position: absolute; top: -5px; right: -5px; background-color: rgba(255, 0, 0, 0.7); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; line-height: 18px; text-align: center; cursor: pointer; padding: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        .preview-item .remove-preview-btn:hover { background-color: rgba(200, 0, 0, 0.9); }
        .current-media-item { margin-bottom: 5px; } /* 既存メディア表示用 */
        .current-media-item button { font-size: 0.8em; padding: 3px 6px; margin-left: 10px; background-color: #e74c3c;}
    </style>
</head>
<body>
    <header>
        <h1>イベント管理アプリ</h1>
    </header>
    <nav id="nav"></nav>

    <div class="container">
        <h2>イベントを編集</h2>
        <div id="messageArea"></div>
        <div id="formLoadingMessage" class="loading-message">イベント情報を読み込み中...</div>
        
        <form id="editEventForm" style="display:none;"> <!-- 初期は非表示 -->
            <input type="hidden" id="eventId"> <!-- 編集対象のイベントID -->

            <div><label for="eventName">イベント名 (必須):</label><input type="text" id="eventName" name="eventName" required></div>
            <div><label for="eventDescription">説明:</label><textarea id="eventDescription" name="eventDescription"></textarea></div>
            <div><label for="eventDate">開始日時:</label><input type="datetime-local" id="eventDate" name="eventDate"></div>
            <div><label for="eventEndDate">終了予定日時:</label><input type="datetime-local" id="eventEndDate" name="eventEndDate"></div>
            <div><label for="eventLocation">場所:</label><input type="text" id="eventLocation" name="eventLocation"></div>
            <div><label for="participationFee">参加費用:</label><input type="text" id="participationFee" name="participationFee" placeholder="例: 1000円 または 無料"></div>
            <div><label for="maxParticipants">最大参加人数 (任意):</label><input type="number" id="maxParticipants" name="maxParticipants" min="1" placeholder="例: 50"></div>

            <div>
                <label>現在のイベント画像:</label>
                <div id="currentImagesContainer" class="preview-container"></div>
                <label for="eventNewImages">新しい画像を追加 (既存画像は維持されます。不要なものは削除してください):</label>
                <input type="file" id="eventNewImages" name="eventNewImages" accept="image/*" multiple>
                <div class="file-count-info" id="newImageCountInfo"></div>
                <div class="preview-container" id="newImagePreviewContainer"></div>
            </div>

            <div>
                <label>現在のイベント動画:</label>
                <div id="currentVideosContainer" class="preview-container"></div>
                <label for="eventNewVideos">新しい動画を追加 (既存動画は維持されます。不要なものは削除してください):</label>
                <input type="file" id="eventNewVideos" name="eventNewVideos" accept="video/*" multiple>
                <div class="file-count-info" id="newVideoCountInfo"></div>
                <div class="preview-container" id="newVideoPreviewContainer"></div>
            </div>

            <fieldset id="formSchemaBuilder">
                <legend>追加の参加登録フォーム項目設定</legend>
                <p>「氏名」と「利用規約への同意」は常に必須です。以下で自由に追加項目を設定できます。</p>
                <div id="formFieldsContainer"></div>
                <button type="button" id="addFormField">追加フォーム項目を追加</button>
            </fieldset>
            
            <div id="loadingIndicator" class="loading-message" style="display: none;">処理中...</div>
            <button type="submit">イベントを更新</button>
            <a href="dashboard.html" style="margin-left: 10px;">キャンセル</a>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabaseClient.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/edit_event.js"></script> <!-- 新しいJSファイル -->
</body>
</html>